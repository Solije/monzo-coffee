{% extends "base.html" %}
{% load staticfiles %}

{% block content %}

{% if messages %}
    {% for message in messages %}
    <div class="ui info message">{{ message }}</div>
    {% endfor %}
{% endif %}

<div class="ui form">
<div class="field">
<label>Account</label>
<div class="ui selection dropdown">
<input type="hidden" name="account">
<i class="dropdown icon"></i>
  <div class="default text">Account</div>
    <div class="menu">
      {% for account in accounts %}
      <div class="item" data-value="{{ account.id }}">{{ account.type }}{% if account.closed %} (closed){% endif %}</div>
      {% endfor %}
    </div>
  </div>
</div>
</div>

<div class="ui segment">
  <div id="ld" class="ui dimmer">
    <div class="ui massive text loader">Tagging Transactions</div>
  </div>

{% comment %} Pending OAuth implementation
  {% if webhook_active %}
  <div class="alert alert-info text-center" role="alert">
    Webhook is active. <a href="{% url 'deactivate-webhook' account_id=account_id %}">Deactivate webhook</a>
  </div>
  {% else %}
  <div class="alert alert-warning text-center" role="alert">
    Webhook is not active. <a href="{% url 'activate-webhook' account_id=account_id %}">Activate webhook</a>
  </div>
  {% endif %}
{% endcomment %}
<script>
$('.dropdown')
  .dropdown({
	  action: function(text, value) {
        	window.location = '/account/' + value;
	  }
  })
;
$(document).ready(function() {
    $('#account-id').val('{{ account_id }}');
});
</script>

<h3>Tag Database</h3>

<button class="ui basic button">
  <i class="icon plus"></i>
  Add Tag
</button>
<br>
<a href="{% url 'tag-new' %}"><span class="glyphicon glyphicon-plus"></span></a>
<br>


<div class="ui statistic">
  <div class="value">
    {{ txn_count }}
  </div>
  <div class="label">
    Transactions tagged
  </div>
</div>

<div class="ui statistic">
  <div class="value">
    {{ tags_used_count }}
  </div>
  <div class="label">
    Total tags
  </div>
</div>

<div class="ui statistic">
  <div class="value">
    {{ tag_counts.items|length }}
  </div>
  <div class="label">
    Different tags used
  </div>
</div>

<div class="ui huge tag labels">
{% for tag, count in tag_counts.items %}
<a class="ui label">{{ tag }} <div class="detail">{{ count }}</div></a>
{% endfor %}

<h2>Suggested Tags</h2>
<select name="suggestions" multiple="" class="ui fluid dropdown">
{% for suggestion in suggestions %}
<option value="{{ suggestion }}">{{ suggestion }}</option>
{% endfor %}
</select>

<button class="ui primary button">
  Apply Tags
</button>

<script>
//$('.tag').on('click', function() {
//  $('#ld').toggleClass('active');
//});
</script>

<div class="ui relaxed divided list">
  {% for tag in custom_tags %}
  <div class="item">
    <i class="large tag middle aligned icon"></i>
    <div class="content">
      <a class="header">{{ tag.label }}</a>
	    <div class="description">
		    <code>{{ tag.expression }}</code>
	    </div>
    </div>
  </div>
  {% endfor %}
</div>


<h3> Preset Tags</h3>
{% for option, value in strftime_codes.items %}
<a href="{% url 'tag-by-time' time_period=option account_id=account_id %}">{{ option }}</a> 
{% endfor %}

</div>


<div class="ui teal buttons">
  <div class="ui button">Tag Menu</div>
  <div class="ui floating dropdown icon button">
    <i class="dropdown icon"></i>
    <div class="menu">
      <div class="item"><i class="edit icon"></i> Rename Tag</div>
      <div class="item"><i class="delete icon"></i> Delete Tag</div>
    </div>
  </div>
</div>

<div id="confirm-delete-tag" class="ui tiny modal">
  <div class="header">Delete tag?</div>
  <div class="content">
    <p>This will remove this tag from all transactions.</p>
  </div>
  <div class="actions">
    <div class="ui approve button">OK</div>
    <div class="ui cancel button">Cancel</div>
  </div>
</div>

<script>
//$('#confirm-delete-tag').modal('show');
</script>

<div class="ui feed">
  {% for event in history %}
  <div class="event">
    <div class="label">
      <i class="undo alternate icon"></i>
    </div>
    <div class="content">
      <div class="summary">
	      Tagged <b>{{ event.txns_affected }}</b> transactions with <b>{{ event.tag }}</b>
	      <div class="date">{{ event.created }}</div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% endblock %}
